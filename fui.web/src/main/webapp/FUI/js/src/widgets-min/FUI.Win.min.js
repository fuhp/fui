(function(a,b){a.widget("FUI.FWin",{options:{buttons:[],modal:true,buttonAlign:"center",width:400,height:300,dragable:true,maxable:false,isIframe:false,pageUrl:"",maximized:false,hasCloseBtn:true},_create:function(){this.firstShow=true},_init:function(){},destroy:function(){var d=this.options;if(d.hasCloseBtn){this.closeBtn.unbind()}this.maxBtn&&this.maxBtn.unbind();var c=this.options.buttons.length;var f=this.element.attr("id");for(var e=0;e<c;e++){a("#"+f+"-btn-"+e).unbind()}this.dragable&&this.dragable.destroy();this.maskEl=null;this.closeBtn=null;this.bodyContentEl=null;this.headerEl=null;this.titleEl=null;this.maxBtn=null;this.dragable=null;this.hiddenArrayList=null;a.Widget.prototype.destroy.call(this)},_prepareHtml:function(){if(this.firstShow){var d=this._generateWinHtml();var c=this.element;c.append(d);this.zIndex=WinIndex.getInstance().getIndex();c.css("z-index",this.zIndex);this._initProperty();this._bindEvent();this.firstShow=false}},show:function(){var d=this.options,e=this.element,g=e.attr("id"),f=d.onShow,c=d.onSetHtml;if(!this.isShown){this._prepareHtml()}this._showBodyMask();e.css("display","block");if(!this.isShown){if(d.maximized){this._max();this._toMaxIcon()}else{this._resize()}if(!d.isIframe&&!d.pageUrl){this.setHtml()}else{this.setPageUrl(d.pageUrl)}this.isShown=true}else{if(!this.isMax){this._rePosition()}else{this._max()}}f&&f()},_getIframeHtml:function(f){var c=[],e=this.element,g=e.attr("id"),d=this.options;c.push('<iframe id="'+g+'-iframe" ');c.push('class="f-win-iframe"  frameborder="0"></iframe>');return c.join("")},setPageUrl:function(g){if(!g){return}var f=this.options,d=window["$Utils"];var h="",e=this.bodyContentEl;var c=f.onSetHtml;e.unbind();e.empty();g=g||f.pageUrl;f.pageUrl=g;g=d.transUrl(g);if(f.isIframe){h=this._getIframeHtml(g);e.html(h);a("iframe:first",e).attr("src",g)}else{a.ajax({context:this,dataType:"html",url:g,success:function(i){e.html(i);c&&c()}})}},setHtml:function(g){var i=g,e=this.bodyContentEl;var f=this.element,j=f.attr("id"),d=this.options,c=d.onSetHtml;e.unbind();e.empty();if(!i){var h=a("#"+j+"-textarea");i=h.val();i=i.replace(/_textarea/g,"textarea");if(i){e.html(i);c&&c()}}else{e.html(i);c&&c()}},close:function(){var d=this.options,c=d.onClose;this.element.css("display","none");this._hideBodyMask();c&&c()},_rePosition:function(m,j){var o=this.options;m=m||o.width,j=j||o.height;var n=a(window),f=a(document);var c=n.width(),k=n.height();var i=jQuery.support.boxModel;var g=i&&document.documentElement.scrollLeft||document.body.scrollLeft;var d=i&&document.documentElement.scrollTop||document.body.scrollTop;var e=(c-m)/2+g;var l=(k-j)/2+d;l<0&&(l=0),e<0&&(e=0);this._showAt(e,l)},_showAt:function(e,d){var c=this.element.get(0).style;c.left=e+"px";c.top=d+"px"},_showBodyMask:function(){var e=this.options,f=this.element;var i=f.attr("id");if(e.modal){var d=window["$Utils"];if(a.browser.msie&&a.browser.version=="6.0"){this._hiddenAllSelectEl()}var c=i+"-mask";var h=a("#"+c);if(h.length==0){var g=this._generateMaskHtml(c);a("body").append(g);this._adjustMask(c);a("#"+c).show()}else{this._adjustMask(c);h.show()}}},_hiddenAllSelectEl:function(){if(this.hasHidden===true){return}var h=0;var g=0;var l;this.hiddenArrayList=this.hiddenArrayList||[];this.hasHidden=true;var d=a("body").children(".f-win").find("select");var k=a("select").not(d);var e=k.length;for(var h=0;h<e;h++){var c=k.get(h);var f=c.style;if(f.display=="none"||f.display=="block"){}else{f.display="none";this.hiddenArrayList.push(c)}}},_showAllSelectEl:function(){if(this.hasHidden===false){return}this.hasHidden=false;var e=this.hiddenArrayList;var d=a.isArray(e)&&e.length||0;if(e!=null&&e!=false&&d>0){for(var c=0;c<d;c++){e[c].style.display=""}}this.hiddenArrayList=e=null},_hideBodyMask:function(){var d=this.options;if(d.modal){if(this.maskEl&&this.maskEl.length){var c=window["$Utils"];if(a.browser.msie&&a.browser.version=="6.0"){this._showAllSelectEl()}this.maskEl.hide()}}},_generateMaskHtml:function(d){var c=[];c.push('<div id="');c.push(d);c.push('" class="f-mask-bg" style ="position:absolute; z-index:');c.push(this.zIndex-5);c.push(';display:none;"></div>');return c.join("")},_adjustMask:function(c){if(c===b){return}var e=a("#"+c);if(e.length){this.maskEl=e;var f=a(document).width();var d=a(document).height();e.width(f);e.height(d)}},_resize:function(){var d=this.options;var c=d.width;var e=d.height;this.setSize(c,e);this.isMax=false},setSize:function(l,j){if(typeof l!="number"||typeof j!="number"){return}var i=this.element,n=this.options;var c=n.onResize;var m=i.find(".f-win-tl");var f=i.find(".f-win-body");var g=i.find(".f-win-bl");this._rePosition(l,j);i.width(l);i.height(j);var d=m.outerHeight(true);var k=g.outerHeight(true);var e=j-d-k;f.height(e-4);f.width(l-16);f.triggerHandler("onResize");c&&c()},_initProperty:function(){var d=this.element;var c=this.options;if(c.hasCloseBtn){this.closeBtn=d.find(".f-win-close")}this.bodyContentEl=d.find(".f-win-body");this.headerEl=d.find(".f-win-header");this.titleEl=d.find(".f-win-title");this.maxBtn=d.find(".f-win-max")},_toMaxIcon:function(){this.dragable&&this.dragable.stop();this.maxBtn.removeClass("f-win-max");this.maxBtn.addClass("f-win-restore");this.headerEl.css("cursor","default");this.titleEl.css("cursor","default")},_toRestoreIcon:function(){this.dragable&&this.dragable.start();this.maxBtn.removeClass("f-win-restore");this.maxBtn.addClass("f-win-max");this.headerEl.css("cursor","move");this.titleEl.css("cursor","move")},_max:function(){var f=a(window),c=a(document);var d=f.width(),e=f.height();this.setSize(d,e);this.isMax=true},_bindEvent:function(){var h=this;var d=this.options;if(d.hasCloseBtn){this.closeBtn.bind("click",function(){h.close()})}if(this.maxBtn&&this.maxBtn.length){this.maxBtn.bind("click",function(m){var l=m.target;var i=l.className;if(i.indexOf("f-win-restore")>-1){h._resize();h._toRestoreIcon()}else{h._max();h._toMaxIcon()}})}var d=this.options;var g=d.buttons;var c=g.length;var f=this.element;var k=f.attr("id");for(var e=0;e<c;e++){var j=g[e].click||function(){};(function(i){a("#"+k+"-btn-"+e).click(function(l){i.call(h)})})(j)}if(d.dragable){this.dragable=new a.Dragable("f-win-title-"+k,k)}else{this.headerEl.css("cursor","default");this.titleEl.css("cursor","default")}},_front:function(){},_generateWinHtml:function(){var c=[],d=this.options,e=this.element,g=e.attr("id");c.push("");c.push('<div class="f-win-tl" ');c.push('id="f-win-title-'+g);c.push('">');c.push('<div class="f-win-tr">');c.push('<div class="f-win-tc">');c.push('<div class="f-win-header">');if(d.hasCloseBtn){c.push('<div class="f-win-tool f-win-close"></div>')}if(d.maxable){c.push('<div class="f-win-tool f-win-max"></div>')}c.push('<span class="f-win-title ">');c.push(d.title);c.push("</span>");c.push("</div>");c.push("</div>");c.push("</div>");c.push("</div>");c.push('<div class="f-win-bwrap">');c.push('<div class="f-win-ml">');c.push('<div class="f-win-mr">');c.push('<div class="f-win-mc">');c.push('<div class="f-win-body" >');c.push("</div>");c.push("</div>");c.push("</div>");c.push("</div>");c.push('<div class="f-win-bl">');c.push('<div class="f-win-br">');c.push('<div class="f-win-bc">');var f=this._generateButtonHtml(d.buttons,d.buttonAlign);c.push(f);c.push("</div>");c.push("</div>");c.push("</div>");c.push("</div>");return c.join("")},_loadContent:function(c){},_generateButtonHtml:function(h,e){var j=[];var g=h.length;if(g==0){j.push('<div style="height:8px;">');j.push("</div>")}else{j.push('<div style="height:40px;">');j.push('<div style="text-align:');j.push(""+e);j.push(';padding:4px 3px 2px 3px;">');j.push('<div style=" display: inline-block;">');j.push("<table><tr>");var c=this.element.attr("id");for(var f=0;f<g;f++){var d=h[f];var l=d.text;var k=d.iconCls;j.push('<td><div class="f-win-btn-l"><div class="f-win-btn-r"><div id="');j.push(c);j.push("-btn-"+f);j.push('" class="f-win-btn-c">');if(k){j.push('<div class="f-win-btn-icon ');j.push(k);j.push('" style="float:left;"></div>');j.push('<div class="f-win-btn-icon-text">')}else{j.push('<div class="f-win-btn-noicon-text">')}j.push(l);j.push("</div></td>")}j.push("</tr></table></div></div></div>")}return j.join("")}})})(jQuery);