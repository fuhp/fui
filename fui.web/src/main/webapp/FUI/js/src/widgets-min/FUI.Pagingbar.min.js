(function(a){a.widget("FUI.FPagingbar",{options:{pageSize:10,maxPageSize:300},_create:function(){var b=this.element;this.id=this.element.attr("id");this.start=1;this.pageIndex=1},_init:function(){var b=this.element.attr("id");this.firstBtn=$I(b+"-page-first");this.prevBtn=$I(b+"-page-prev");this.nextBtn=$I(b+"-page-next");this.lastBtn=$I(b+"-page-last");this.refreshBtn=$I(b+"-page-refresh");this.beforePageTextSpan=$I(b+"-page-beforeText");this.afterPageTextSpan=$I(b+"-page-afterText");this.beforePageSizeTextSpan=$I(b+"-page-size-beforeText");this.afterPageSizeTextSpan=$I(b+"-page-size-afterText");this.pageSizeInput=$I(b+"-page-size-input");this.inputBtn=$I(b+"-page-input");this.msgText=$I(b+"-page-totalcount");if(this.beforePageTextSpan.length>0){this.options.pageSize=parseInt(this.options.pageSize)||10;this.options.maxPageSize=parseInt(this.options.maxPageSize)||300;if(this.options.maxPageSize<0){this.options.maxPageSize=300}if(this.options.pageSize<1){this.options.pageSize=1}if(this.options.pageSize>this.options.maxPageSize){this.options.pageSize=this.options.maxPageSize}this.pageSizeInput.val(this.options.pageSize)}this._initI18n();this._initMsg();this._bindPageEvent()},getParams:function(){var d={};var c=this.options.pageSize;var b=this.pageIndex;var e=1+((b-1)*c);this.start=e;d.start=e;d.limit=c;d.pageNum=b;return d},getDefaultParams:function(){var c={};var b=this.options.pageSize;this.pageIndex=1;this.start=1;c.start=this.start;c.limit=b;c.pageNum=this.pageIndex;return c},resetPagebar:function(c,g){var f=window["$Utils"];var b=this.pageIndex;this.totalCount=g;var e=this.options.pageSize;this.pageCount=parseInt(this.totalCount/e);if(g%e>0){this.pageCount++}if(g){if(b<2){this._disableButton(this.firstBtn);this._disableButton(this.prevBtn)}else{this._enableButton(this.firstBtn);this._enableButton(this.prevBtn)}if(b<this.pageCount){this._enableButton(this.nextBtn);this._enableButton(this.lastBtn)}else{this._disableButton(this.nextBtn);this._disableButton(this.lastBtn)}}else{this._disableButton(this.firstBtn);this._disableButton(this.prevBtn);this._disableButton(this.nextBtn);this._disableButton(this.lastBtn)}this._enableButton(this.refreshBtn);var h=this.start;var d=h+e-1;(d>g)&&(d=g);this.inputBtn.val(b);this.pageSizeInput.val(e);this.afterPageTextSpan.text(f.format(this.afterPageText,this.pageCount));this.msgText.text(f.format(this.pageTotalMsg,h,d,g))},_initI18n:function(){var b=a.FUI.lang&&a.FUI.lang.pagingbar||{};this.beforePageText=b.beforePageText||"第";this.afterPageText=b.afterPageText||"页 共{0} 页";this.pageTotalMsg=b.pageTotalMsg||"显示{0}到{1},共{2}条数据";this.beforePageSizeText=b.beforePageSizeText||"每页";this.afterPageSizeText=b.afterPageSizeText||"条"},_initMsg:function(){var b=window["$Utils"];this.beforePageTextSpan.text(this.beforePageText);this.afterPageTextSpan.text(b.format(this.afterPageText,"0"));this.msgText.text(b.format(this.pageTotalMsg,"0","0","0"));this.beforePageSizeTextSpan.text(this.beforePageSizeText);this.afterPageSizeTextSpan.text(this.afterPageSizeText)},_first:function(){this.pageIndex=1;this._doLoad()},_prev:function(){var b=this.pageIndex-1;b=b>0?b:1;this.pageIndex=b;this._doLoad()},_next:function(){this.pageIndex++;this._doLoad()},_last:function(){this.pageIndex=this.pageCount;this._doLoad()},_refresh:function(){this._tryPageSizeChange();this._doLoad(true)},_tryPageSizeChange:function(){if(this.pageSizeInput.length==0){return}var b=parseInt(this.pageSizeInput.val());if(isNaN(b)){this.pageSizeInput.val(this.options.pageSize);return}if(b<1){b=1}if(b>this.options.maxPageSize){b=this.options.maxPageSize}this.pageSizeInput.val(b);if(this.options.pageSize===b){return}this.options.pageSize=b;this.start=1;this.pageIndex=1},_doLoad:function(e){var b=window["$Component"];if(!this.gridId){this.gridId=this.element.parent().attr("id")}var d=this.getParams();var c=$I(this.gridId);if(e){b.tryCall(c,"resetDataCache",false,e)}else{b.tryCall(c,"resetDataCache",false)}b.tryCall(c,"loadForPagingbar",d);c=null},_disableButton:function(c){var b=c.attr("f_grid_page_status");if("enable"==b){var d=c.attr("f_grid_page_type");c.get(0).className="f-grid-page-button  f-grid-page-"+d+"-disabled";c.attr("f_grid_page_status","disabled")}},_enableButton:function(c){var b=c.attr("f_grid_page_status");if("disabled"==b){var d=c.attr("f_grid_page_type");c.get(0).className="f-grid-page-button f-grid-page-btn f-grid-page-"+d;c.attr("f_grid_page_status","enable")}},_bindPageEvent:function(){var d=this;var e=this.element;var f=this.inputBtn;var c=this.pageSizeInput;var b=window["$Utils"];e.bind({click:function(j){var g=j.target;var i=g.getAttribute("f_grid_page_type");var h=g.getAttribute("f_grid_page_status");if(i&&h!=="disabled"){if("first"==i){d._first()}else{if("prev"==i){d._prev()}else{if("next"==i){d._next()}else{if("last"==i){d._last()}else{if("refresh"==i){d._refresh()}}}}}}},mouseover:function(j){var g=j.target;var i=g.getAttribute("f_grid_page_type");var h=g.getAttribute("f_grid_page_status");if(i&&h==="enable"){b.replaceClass(g,"f-grid-page-button f-grid-page-btn f-grid-page-"+i+"-hover")}},mouseout:function(j){var g=j.target;var i=g.getAttribute("f_grid_page_type");var h=g.getAttribute("f_grid_page_status");if(i&&h==="enable"){b.replaceClass(g,"f-grid-page-button f-grid-page-btn f-grid-page-"+i)}},mousedown:function(j){var g=j.target;var i=g.getAttribute("f_grid_page_type");var h=g.getAttribute("f_grid_page_status");if(i&&h==="enable"){b.replaceClass(g,"f-grid-page-button f-grid-page-btn f-grid-page-"+i+"-active")}},mouseup:function(j){var g=j.target;var i=g.getAttribute("f_grid_page_type");var h=g.getAttribute("f_grid_page_status");if(i&&h==="enable"){b.replaceClass(g,"f-grid-page-button f-grid-page-btn f-grid-page-"+i+"-hover")}}});c.bind({keydown:function(h){var g=h.keyCode;if(g==13){d._tryPageSizeChange();d._doLoad(true)}}});f.bind({blur:function(g){d.inputBtn.val(d.pageIndex)},keydown:function(l){var i=l.target;var k=l.keyCode;if(k==13){var h=parseInt(i.value);var j=/^[0-9]*[1-9][0-9]*$/;var g=j.exec(h);if(g){if(h>d.pageCount){h=d.pageCount;d.afterPageTextSpan.text(b.format(d.afterPageText,h))}if(d.pageIndex!=h){d.pageIndex=h;d._doLoad()}}else{d.inputBtn.val(d.pageIndex)}}}})},destroy:function(){this.element.unbind();this.inputBtn.unbind();this.inputBtn=null;this.firstBtn=null;this.prevBtn=null;this.nextBtn=null;this.lastBtn=null;this.refreshBtn=null;this.beforePageTextSpan=null;this.afterPageTextSpan=null;this.beforePageSizeTextSpan=null;this.afterPageSizeTextSpan=null;this.msgText=null}})})(jQuery);