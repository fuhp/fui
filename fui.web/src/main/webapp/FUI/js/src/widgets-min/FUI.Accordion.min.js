(function($){$.registerWidgetEvent("");$.widget("FUI.FAccordion",{options:{id:null,active:0,height:"auto",_contentHeight:"auto",width:"auto",onActive:null,onBeforeActive:null,onBeforeCollapse:null,onCollapse:null,_objHeaders:null,_curActiveId:null,_showProps:{height:"show"},_hideProps:{height:"hide"}},destroy:function(){this._destroy();$.Widget.prototype.destroy.call(this)},_destroy:function(){op._objHeaders||op._objHeaders.destory();op._objHeaders=null},_create:function(){var self=this;var op=self.options;op.id=this.element.attr("id");op._objHeaders=$Utils.IndexMap();self._initHeaders()},_initHeaders:function(){var self=this;var op=self.options;var headerMappings=op._objHeaders;var headers=self.element.children(".f-accordion-header");var size=headers.length;for(var i=0;i<size;i++){var el=$(headers.get(i));if(i==size-1){el.addClass("f-accordion-header-last-collapsed")}el.click(function(){self._toggleActivate(headerMappings.indexOf($(this).attr("id")))});headerMappings.put(el.attr("id"),el)}},_init:function(){var self=this;var op=self.options;self.setSize(op.width,op.height);self.activate(op.active)},_toggleActivate:function(n){var self=this;var op=self.options;var headers=op._objHeaders;var size=headers.size();var id=headers.element(n).key;if(id==op._curActiveId){if(n>=0&&n<size-1){n=n+1}else{if(n==size-1){n=n-1}}}self.activate(n)},activate:function(n){var self=this;var op=self.options;var headers=op._objHeaders;var size=headers.size();var el=self._parseToEl(n,headers);if(!el||el.length==0){return false}var id=el.attr("id");var index=headers.indexOf(id);var curActiveId=op._curActiveId;if(id===curActiveId){return false}if(op._curActiveId&&op.onBeforeCollapse){var result=self._tryExcuteFunc(self,op.onBeforeCollapse,[headers.indexOf(op._curActiveId)]);if(result===false){return false}}if(op.onBeforeActive){var result=self._tryExcuteFunc(self,op.onBeforeActive,[index]);if(result===false){return false}}var toHide=self._hideCurActive();var toShow=self._showActive(index,id,el);!toHide||toHide.addClass("f-state-hide");toShow.removeClass("f-state-hide");var lasActiveId=op._curActiveId;op._curActiveId=id;!op.onCollapse||self._tryExcuteFunc(self,op.onCollapse,[headers.indexOf(lasActiveId)]);!op.onActive||self._tryExcuteFunc(self,op.onActive,[index])},_animate:function(toHide,toShow){var op=this.options;var height=op._contentHeight;var adjust=0;!toHide||toHide.stop(true,true).animate(op._hideProps,{duration:"fast",step:function(now,fx){fx.now=Math.round(now)}});toShow.stop(true,true).animate(op._showProps,{duration:"fast",step:function(now,fx){fx.now=Math.round(now);if(fx.prop!=="height"){adjust+=fx.now}else{if(toHide&&!isNaN(height)){fx.now=Math.round(height-toHide.height()-adjust);adjust=0}}}})},_hideCurActive:function(){var self=this;var op=self.options;var headers=op._objHeaders;var id=op._curActiveId;if(!id){return null}var el=headers.get(id);var contentEl=el.next();if(!el||el.length==0||!contentEl||contentEl.length==0){return null}if(headers.indexOf(el.attr("id"))===headers.size()-1){el.addClass("f-accordion-header-last-collapsed")}el.children(".f-accordion-tool").addClass("f-tool-expand").removeClass("f-tool-collapse");var nextHeader=contentEl.next();nextHeader.removeClass("f-accordion-header-sibling-expanded");return contentEl},_showActive:function(n,id,el){var self=this;var op=self.options;var headers=op._objHeaders;var contentEl=el.next();if(n==headers.size()-1){el.removeClass("f-accordion-header-last-collapsed")}el.children(".f-accordion-tool").addClass("f-tool-collapse").removeClass("f-tool-expand");var nextHeader=contentEl.next();nextHeader.addClass("f-accordion-header-sibling-expanded");return contentEl},_parseToEl:function(n,headers){if($Utils.isJQueryObj(n)){return n}headers=headers||this.options._objHeaders;var size=headers.size();if(!isNaN(n)){if(n<0){n=0}else{if(n>=size){n=size-1}}return headers.element(n).value}if($Utils.isString(n)){return this.element.children("#"+n)}return null},getActivated:function(){return this.options._curActiveId},getByIndex:function(n){return this.options._objHeaders.element(n).key},getLength:function(){return this.options._objHeaders.size()},setTitle:function(n,title){var self=this;var op=self.options;var el=self._parseToEl(n,op._objHeaders);if(!el||el.length==0){return false}title=title||" ";el.children(".f-accordion-header-text").html(title)},setSize:function(w,h){var self=this;var op=self.options;var selfEl=this.element;if(w){w=parseInt(w);if(!isNaN(w)){w=w-2;if(w<0){w=0}}else{w=selfEl.parent().width()-2;if(w<0){w=0}}if(op.width!==w){selfEl.width(w);self._adjustWidth(w)}op.width=w}if(h){var rh=parseInt(h);if(!isNaN(rh)){rh=rh-2;if(rh<0){rh=0}}else{if(h==="fit"){rh=selfEl.parent().height()-2;if(rh<0){rh=0}}else{rh="auto"}}if(op.height!==rh){selfEl.height(rh);self._adjustHeight(rh)}op.height=h}},_adjustWidth:function(w){var self=this;var op=self.options;var headers=op._objHeaders.elements;var size=headers.length;var contentWidth="auto";if(!isNaN(w)){contentWidth=w-2;if(contentWidth<0){contentHeight=0}}for(var i=0;i<size;i++){var el=headers[i].value;var contentEl=el.next();contentEl.width(contentWidth)}op._contentWidth=contentWidth},_adjustHeight:function(h){var self=this;var op=self.options;var headers=op._objHeaders.elements;var size=headers.length;var contentHeight="auto";if(!isNaN(h)){contentHeight=h-size*28;if(contentHeight<0){contentHeight=0}}for(var i=0;i<size;i++){var el=headers[i].value;var contentEl=el.next();contentEl.height(contentHeight)}op._contentHeight=contentHeight},_tryExcuteFunc:function(obj,func,args){var EMPTY_FUNC=function(){};var f=func||EMPTY_FUNC;if(!$.isFunction(func)){try{f=eval(func);if(!$.isFunction(f)){return}}catch(e){return}}args=args||[];return f.apply(obj,args)}})})(jQuery);