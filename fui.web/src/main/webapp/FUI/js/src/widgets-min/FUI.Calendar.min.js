(function(a){a.FUI.FDate=function(){this.y=0,this.M=0,this.d=0,this.H=0,this.m=0,this.s=0;this.lastFmt="";this.lastDateStr="";this._reset=function(){this.y=this.M=this.d=this.H=this.m=this.s=0};this.parseStr=function(j,c){var o=this;var k,h,m,d,l,b;c=c||"yyyy-MM-dd";o.lastFmt=c;o.lastDateStr=j;for(var e=0;e<c.length;){var n=o._parseLiteral(c,e);if(n.literal==null){break}var g=n.startIndex;var f=n.count;o[n.literal]=Number(j.substr(g,f),10);e=g+f}};this._parseLiteral=function(b,j){var e=null;var f=0;var h=-1;var g="";for(var c=j;c<b.length;c++){var d=b.charAt(c);if(e!=null){if(e==d){f++;g=g+d}else{break}}else{if(d=="y"||d=="M"||d=="d"||d=="H"||d=="m"||d=="s"){e=d;f++;g=g+d;h=c}}}return{literal:e,count:f,startIndex:h,value:g}};this.toString=function(c){var j=this;c=c||"yyyy-MM-dd";if(j.lastFmt==c){return j.lastDateStr}var k=c;for(var d=0;d<c.length;){var h=j._parseLiteral(c,d);if(h.literal==null){break}var g=h.literal;var e=h.count;var b=h.value;var f=j._getLiteralValue(g,e);k=k.replace(b,f);d=h.startIndex+e}return k};this._getLiteralValue=function(d,e){var b=this;var f=""+b[d];var g=e-f.length;if(g>0){for(var c=0;c<g;c++){f="0"+f}}return f}};a.widget("FUI.FCalendar",{options:{id:null,showOpts:null,selectable:true},_create:function(){var b=window["$Utils"],d=this.options,e=this.element;d.id=e.attr("id");d.showOpts=d.showOpts||{};var c=e.next().attr("readonly");if(c){this.options.showOpts=b.apply(this.options.showOpts||{},{readOnly:true})}},_init:function(){this._bindEvent()},_bindEvent:function(){var b=this;var e=b.element.FTextField("getInputEl");if(!e.is("input")){return}var d=this.options;var c=$I(d.id+"-trigger");if(c.size()!=0){c.click(function(){if($I(d.id).FTextField("disabled")===true||!b.isSelectable()){return}e.unbind("focus.FCalendar");b.show()})}e.bind("focus.FCalendar",function(){if($I(d.id).FTextField("disabled")===true||b.isReadonly()){return}e.unbind("focus.FCalendar");b.show()});b.element.bind("onValueChanged",function(j,n){var f="";var i=b.options;if(!n){$I(i.id+"-input").val("")}else{var g=new a.FUI.FDate();var k=i.realDateFmt||(i.showOpts||{}).realDateFmt;var h=i.realTimeFmt||(i.showOpts||{}).realTimeFmt;var l=i.realFullFmt||(i.showOpts||{}).realFullFmt;var m=i.dateFmt||(i.showOpts||{}).dateFmt;if(k){f=k}else{if(h){f=h}else{f=l}}g.parseStr(n,f);$I(i.id+"-input").val(g.toString(m))}})},setValue:function(b,c){return this.element.FTextField("value",b,c)},getValue:function(){return this.element.FTextField("value")},reset:function(){return this.element.FTextField("reset")},setDisabled:function(b){return this.element.FTextField("disabled",b)},isDisabled:function(){return this.element.FTextField("disabled")},setSelectable:function(b){if(b===true||b===false){this.options.selectable=b}},isSelectable:function(){return this.options.selectable},setReadonly:function(b){if(undefined===b){return false}if(true===b||"true"==b){this.options.showOpts.readOnly=true}else{this.options.showOpts.readOnly=false}return this.element.FTextField("readonly",b)},isReadonly:function(){return this.element.FTextField("readonly")},show:function(d){var b=this;var c=this.options;d=d||c.showOpts||{};d=a.extend({},d,{el:c.id+"-input",vel:c.id,position:b._calPosition()});c.dateFmt=d.dateFmt;c.realDateFmt=d.realDateFmt;c.realTimeFmt=d.realTimeFmt;c.realFullFmt=d.realFullFmt;WdatePicker(d)},hide:function(){$dp.hide()},setShowOpts:function(b){this.options.showOpts=b},_calPosition:function(){var c=this.element;var b=c.FTextField("getBoxEl");if(b.hasClass("f-textField-icon-right")||b.hasClass("f-textField-icon-left")||b.hasClass("f-textField-icon-inner-right")){return{left:-4,top:1}}else{if(b.hasClass("f-textField-icon-inner-left")){return{left:-19,top:1}}}},destroy:function(){var b=this.options;a.Widget.prototype.destroy.call(this)}})})(jQuery);