(function(a,b){a.widget("FUI.FNumberField",{options:{decimals:2,moneyFormat:false,defaultValue:null,afterChange:null},MAX_LENGTH:15,_create:function(){var c=this.options;c.id=this.element.attr("id");this._bindEvent()},_init:function(){var d=this.options;this.setDecimals(d.decimals);var c=d.moneyFormat;if(c==true||c=="true"){d.moneyFormat=true}else{d.moneyFormat=false}if(d.defaultValue){this.reset()}},_getInputEl:function(){var c=this;var d=this.options;if(!d._inputEl){d._inputEl=c.element.next()}return d._inputEl},_getHiddenEl:function(){var c=this;var d=this.options;if(!d._hiddenEl){d._hiddenEl=c.element}return d._hiddenEl},destroy:function(){this.options._hiddenEl=null;this.options._inputEl=null;a.Widget.prototype.destroy.call(this)},_bindEvent:function(){var d=this;var e=d._getEvent("input");this._getInputEl().bind(e);var c=d._getHiddenEl();c.bind("onValueChanged",function(g,f){d._triggerValueChanged(a(this).val())})},_getEvent:function(h){var c=this,k=c.options,e=this.element;var j=this;var g=this.options;var i=j._getInputEl();var d=j._getHiddenEl();var f={keydown:function(p){var o=p.keyCode;if(48<=o&&o<=57||96<=o&&o<=105||o==190||o==110||o==109||o==189){if(o==190||o==110){if(g.decimals<1){return false}else{return true}}var n=i.val();var m=n.length+1;var l=j.MAX_LENGTH;if(g.decimals>=1){if(n.lastIndexOf(".")>=0){m-=1}else{m+=g.decimals}}if(m>l){return false}return true}else{if(o==37||o==38||o==39||o==40||o==8||o==46||o==9||o==13||o==108){return true}}return false},focus:function(l){j._getInputEl().val(j._getHiddenEl().val())},blur:function(m){var l=j._getHiddenEl().val();j._getHiddenEl().val(j._getInputEl().val());j._triggerValueChanged(l)}};if(h=="input"){return f}},_num2num:function(c,d){d=d>=0&&d<=20?d:2;c=parseFloat((c+"").replace(/[^\d\.-]/g,"")).toFixed(d);return c},_num2money:function(f){f=(f+"").split(".");var c=f[0].split("").reverse();var g=f[1];if(g){g="."+g}else{g=""}var e="";for(var d=0;d<c.length;d++){e+=c[d]+((d+1)%3==0&&(d+1)!=c.length&&c[(d+1)]!="-"?",":"")}return e.split("").reverse().join("")+g},_money2num:function(c){return parseFloat(c.replace(/[^\d\.-]/g,""))},_triggerValueChanged:function(g){var d=this;var c=d._getHiddenEl();var f=d._getInputEl();var j=d.options;var e=c.val();var i=d._num2num(e,j.decimals);if(!isNaN(i)){if(i!=e){c.val(i)}if(true==j.moneyFormat){var h=d._num2money(i);f.val(h)}else{f.val(i)}}else{f.val("");c.val("")}if(a.isFunction(j.afterChange)){var e=c.val();if(g!==e){j.afterChange(e,g)}}},setValue:function(c){var d=this.element.val();this.element.val(c);this._triggerValueChanged(d)},getValue:function(){return this._getHiddenEl().FTextField("getValue")},reset:function(){var c=this.options.defaultValue||"";this.setValue(c)},setDisabled:function(c){return this.element.FTextField("disabled",c)},isDisabled:function(){return this.element.FTextField("disabled")},setReadonly:function(c){if(b===c){return false}return this.element.FTextField("readonly",c)},isReadonly:function(){return this.element.FTextField("readonly")},setDecimals:function(c){var d=this.options;d.decimals=c;var c=parseInt(d.decimals);if(isNaN(c)||c<0){c=0}d.decimals=c}})})(jQuery);