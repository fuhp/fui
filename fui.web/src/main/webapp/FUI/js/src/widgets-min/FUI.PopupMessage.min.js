(function(a){a.registerWidgetEvent("");a.widget("FUI.FPopupMessage",{options:{title:"",timeout:null,closable:null,offset:null,container:null,_popupMsgs:null},_create:function(){this.options.id=this.element.attr("id")},_init:function(){},show:function(d){var b=this;var g=this.element;if(b.options._popupMsgs==null){b.options._popupMsgs=$Utils.IndexMap()}var f=b._processOptions(d);if(!g.hasClass("f-popupMessage")){f.id=(d||{}).id;var c=b._genPopupMessageHTML(f);g.append(c);b.options._popupMsgs.put(f.id,f.id)}else{f.id=g.attr("id")}f._element=$I(f.id);if(f._element.size()==0){return}var e=f._element.data("_option");if(e){b._destroyPopup(e.id,e._element)}f._element.data("_option",f);b._initPopup(f);b._bindEvent(f);f._element.FPopupBox("show",f,function(){f._show=true})},_initPopup:function(c){var b=c._element;b.FPopupBox({});c._show=false},_bindEvent:function(h){var g=h.id;var b=this;var f=h._element;$I(g+"-icon").hover(function(){a(this).addClass("f-tool-closethick").removeClass("f-tool-close")},function(){a(this).removeClass("f-tool-closethick").addClass("f-tool-close")}).click(function(){if(h.closable){b.hide(h)}});var d=parseInt(h.timeout||"");if(!isNaN(d)&&d>0){h._timeReset=0;if(d<1000){d=1000}var c=++h._timeReset;var e=a.proxy(b,"_tryTimeoutClose",c,h);setTimeout(e,d);f.hover(function(){h._timeReset++},function(){var i=++h._timeReset;var j=a.proxy(b,"_tryTimeoutClose",i,h);setTimeout(j,d)})}h._changed=0;a(window).bind("scroll.FPopupMessage-"+g,function(){if(!h._show){return}h._changed++;var j=h._changed;var i=a.proxy(b,"_scrollFunc",j,h);setTimeout(i,500)}).bind("resize.FPopupMessage-"+g,function(){if(!h._show){return}h._changed++;var j=h._changed;var i=a.proxy(b,"_scrollFunc",j,h);setTimeout(i,100)})},_tryTimeoutClose:function(b,c){if(c._show&&c._timeReset===b){this.hide(c)}},_scrollFunc:function(c,b){if(b._show&&c==b._changed){b._element.FPopupBox("show",b)}},_processOptions:function(c){var b=a.extend({},this.options,(c||{}));b.position=b.position||{left:500000,top:500000};b.collision="fit";b.container=b.container||window;b.offset=b.offset||{left:-5,top:-5};b.show=b.show||{effect:"fadeIn",duration:"fast"};b.hide=b.hide||{effect:"fadeOut",duration:"fast"};return b},_genPopupMessageHTML:function(i){var b=[];var h=i.id||$Utils.genId("f-popupMessage");i.id=h;var f=(i.title||"").toString();var g="";if(f.length==0){g="style='display:none;'"}var d="";if(i.closable==false||i.closable=="false"){d="style='display:none;'";i.closable=false}else{i.closable=true}var e=i.content||"";var c="	    	<div id='{0}' class='f-popupMessage f-widget f-corner-all'>	    	  <div id='{0}-header' {2} class='f-popupMessage-header'> 	    	    {1} 	    	    <span id='{0}-icon' {3} class='f-popupMessage-icon f-tool f-tool-close'>&nbsp;</span> 	    	  </div> 	    	  <div id='{0}-body' class='f-popupMessage-body'> 	    	  	{4}	    	  </div> 	    	</div>";return $Utils.format(c,h,f,g,d,e)},setContent:function(b){if(this.element.hasClass("f-popupMessage")){var c=this.options.id;$I(c+"-body").html(b)}},hide:function(g,f){if(this.element.hasClass("f-popupMessage")){var e=this.element.data("_option");if(e&&e._show){this.element.FPopupBox("hide",g);this._destroyPopup(e.id,e._element);e._show=false}}else{var c=0;var d=this.options._popupMsgs;if(this.options._popupMsgs){c=d.size()}if($Utils.isString(g)){if(c>0&&d.get(g)!=null){this._hideGenPopup(g,f,d)}}else{if(typeof g=="object"&&g._element!=null){this._hideGenPopup(g.id,f,d)}else{if(c!=0){for(var b=0;b<c;b++){this._hideGenPopup(d.element(d.size()-1).key,g,d)}}}}}},_hideGenPopup:function(g,e,d){var c=$I(g);var b=this;var f=c.data("_option");if(f){c.FPopupBox("hide",e,function(){b._destroyPopup(g,c);f._show=false;c.remove()});d.remove(g)}},_destroyPopup:function(d,b){if(!d||!b){return}var c=b.data("_option");if(c){c._show=false;b.removeData("_option");b.unbind()}$I(d+"-icon").unbind();a(window).unbind(".FPopupMessage-"+d)},destroy:function(){var g=this.options;if(this.element.hasClass("f-popupMessage")){this._destroyPopup(g.id,this.element)}else{var e=g._popupMsgs;if(e){var c=e.size();for(var b=0;b<c;b++){var f=e.element(b).key;var d=$I(f);this._destroyPopup(f,d)}}}g._popupMsgs.destroy();g._popupMsgs=null;a.Widget.prototype.destroy.call(this)}})})(jQuery);